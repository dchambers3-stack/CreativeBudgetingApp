import { Injectable } from '@angular/core';
import i18next from 'i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

@Injectable({
  providedIn: 'root',
})
export class I18nService {
  private isInitialized = false;

  async initializeI18n(): Promise<void> {
    try {
      await i18next.use(LanguageDetector).init({
        debug: false,
        fallbackLng: 'en',
        supportedLngs: ['en', 'es', 'fr'],
        detection: {
          order: ['localStorage', 'navigator', 'htmlTag'],
          caches: ['localStorage'],
          lookupLocalStorage: 'i18nextLng',
        },
        interpolation: {
          escapeValue: false,
        },
        resources: {
          en: {
            translation: {
              auth: {
                login: {
                  title: 'Sign In',
                  username: 'Username',
                  password: 'Password',
                  loginButton: 'Sign In',
                  registerLink: "Don't have an account? Sign up",
                  error: 'Invalid username or password',
                  alreadyLoggedIn:
                    'You are already logged in. Please click the button below to go to your Dashboard.',
                },
                register: {
                  title: 'Create Account',
                  username: 'Username',
                  email: 'Email',
                  password: 'Password',
                  confirmPassword: 'Confirm Password',
                  registerButton: 'Create Account',
                  loginLink: 'Already have an account? Sign in',
                  success: 'Account created successfully',
                },
              },
              navigation: {
                dashboard: 'Dashboard',
                addExpenses: 'Add Expenses',
                paychecks: 'Paychecks',
                payInfo: 'Pay Information',
                howToBudget: 'How to Budget',
                tickets: 'My Tickets',
                createTicket: 'Create Ticket',
                logout: 'Logout',
                home: 'Home',
                profile: 'Profile',
              },
              dashboard: {
                title: 'Budget Dashboard',
                welcome: 'Welcome to your Budget Dashboard',
                totalIncome: 'Total Income',
                totalExpenses: 'Total Expenses',
                remainingBudget: 'Remaining Budget',
                recentTransactions: 'Recent Transactions',
                budgetCategories: 'Budget Categories',
                monthlyOverview: 'Monthly Overview',
                savingsGoal: 'Savings Goal',
                expenseBreakdown: 'Expense Breakdown',
                noData: 'No data available',
                addFirstExpense: 'Add your first expense to get started',
              },
              expenses: {
                title: 'Add Expenses',
                category: 'Category',
                amount: 'Amount',
                description: 'Description',
                date: 'Date',
                frequency: 'Frequency',
                addButton: 'Add Expense',
                editButton: 'Edit Expense',
                deleteButton: 'Delete Expense',
                success: 'Expense added successfully',
                error: 'Failed to add expense',
                deleteConfirm: 'Are you sure you want to delete this expense?',
                recurring: 'Recurring Expense',
                oneTime: 'One-time Expense',
              },
              paychecks: {
                title: 'Paycheck Management',
                grossPay: 'Gross Pay',
                netPay: 'Net Pay',
                payDate: 'Pay Date',
                payFrequency: 'Pay Frequency',
                addPaycheck: 'Add Paycheck',
                editPaycheck: 'Edit Paycheck',
                deductions: 'Deductions',
                taxes: 'Taxes',
                benefits: 'Benefits',
                overtime: 'Overtime',
                bonus: 'Bonus',
              },
              payDetails: {
                title: 'Pay Information',
                personalInfo: 'Personal Information',
                firstName: 'First Name',
                lastName: 'Last Name',
                email: 'Email',
                phone: 'Phone Number',
                address: 'Address',
                city: 'City',
                state: 'State',
                zipCode: 'ZIP Code',
                saveButton: 'Save Information',
                updateSuccess: 'Information updated successfully',
              },
              helpdesk: {
                tickets: {
                  title: 'My Support Tickets',
                  ticketId: 'Ticket ID',
                  subject: 'Subject',
                  status: 'Status',
                  priority: 'Priority',
                  created: 'Created',
                  updated: 'Last Updated',
                  noTickets: 'No tickets found',
                  viewDetails: 'View Details',
                  closeTicket: 'Close Ticket',
                },
                createTicket: {
                  title: 'Create Support Ticket',
                  subject: 'Subject',
                  description: 'Description',
                  priority: 'Priority',
                  category: 'Category',
                  submitButton: 'Submit Ticket',
                  success: 'Ticket created successfully',
                  error: 'Failed to create ticket',
                },
              },
              howToBudget: {
                title: 'How to Budget',
                introduction: 'Learn the basics of budgeting',
                step1: 'Track Your Income',
                step2: 'List Your Expenses',
                step3: 'Set Financial Goals',
                step4: 'Create Your Budget',
                step5: 'Monitor and Adjust',
                tips: 'Budgeting Tips',
                resources: 'Additional Resources',
              },
              common: {
                save: 'Save',
                cancel: 'Cancel',
                delete: 'Delete',
                edit: 'Edit',
                add: 'Add',
                update: 'Update',
                create: 'Create',
                submit: 'Submit',
                loading: 'Loading...',
                error: 'An error occurred',
                success: 'Operation completed successfully',
                confirm: 'Confirm',
                yes: 'Yes',
                no: 'No',
                close: 'Close',
                back: 'Back',
                next: 'Next',
                previous: 'Previous',
                search: 'Search',
                filter: 'Filter',
                clear: 'Clear',
                total: 'Total',
                subtotal: 'Subtotal',
                required: 'This field is required',
                invalidEmail: 'Please enter a valid email address',
                passwordMismatch: 'Passwords do not match',
                selectLanguage: 'Select Language',
                currentLanguage: 'Current Language',
                availableLanguages: 'Available Languages',
              },
              categories: {
                title: 'Categories',
                housing: 'Housing',
                transportation: 'Transportation',
                food: 'Food & Dining',
                utilities: 'Utilities',
                healthcare: 'Healthcare',
                entertainment: 'Entertainment',
                shopping: 'Shopping',
                education: 'Education',
                insurance: 'Insurance',
                savings: 'Savings',
                debt: 'Debt Payment',
                other: 'Other',
              },
              frequency: {
                weekly: 'Weekly',
                biweekly: 'Bi-weekly',
                monthly: 'Monthly',
                quarterly: 'Quarterly',
                annually: 'Annually',
                oneTime: 'One-time',
              },
              status: {
                open: 'Open',
                inProgress: 'In Progress',
                resolved: 'Resolved',
                closed: 'Closed',
                pending: 'Pending',
                active: 'Active',
                inactive: 'Inactive',
              },
              priority: {
                low: 'Low',
                medium: 'Medium',
                high: 'High',
                urgent: 'Urgent',
              },
              months: {
                january: 'January',
                february: 'February',
                march: 'March',
                april: 'April',
                may: 'May',
                june: 'June',
                july: 'July',
                august: 'August',
                september: 'September',
                october: 'October',
                november: 'November',
                december: 'December',
              },
              errors: {
                networkError: 'Network error. Please check your connection.',
                serverError: 'Server error. Please try again later.',
                unauthorizedError:
                  'You are not authorized to perform this action.',
                validationError: 'Please check your input and try again.',
                notFoundError: 'The requested resource was not found.',
              },
            },
          },
          es: {
            translation: {
              auth: {
                login: {
                  title: 'Iniciar Sesión',
                  username: 'Nombre de Usuario',
                  password: 'Contraseña',
                  loginButton: 'Iniciar Sesión',
                  registerLink: '¿No tienes cuenta? Regístrate',
                  error: 'Usuario o contraseña inválidos',
                  alreadyLoggedIn:
                    'Ya has iniciado sesión. Haz clic en el botón de abajo para ir a tu Panel de Control.',
                },
                register: {
                  title: 'Crear Cuenta',
                  username: 'Nombre de Usuario',
                  email: 'Correo Electrónico',
                  password: 'Contraseña',
                  confirmPassword: 'Confirmar Contraseña',
                  registerButton: 'Crear Cuenta',
                  loginLink: '¿Ya tienes cuenta? Inicia sesión',
                  success: 'Cuenta creada exitosamente',
                },
              },
              navigation: {
                dashboard: 'Panel de Control',
                addExpenses: 'Agregar Gastos',
                paychecks: 'Nóminas',
                payInfo: 'Información de Pago',
                howToBudget: 'Cómo Hacer Presupuesto',
                tickets: 'Mis Tickets',
                createTicket: 'Crear Ticket',
                logout: 'Cerrar Sesión',
                home: 'Inicio',
                profile: 'Perfil',
              },
              dashboard: {
                title: 'Panel de Presupuesto',
                welcome: 'Bienvenido a tu Panel de Presupuesto',
                totalIncome: 'Ingresos Totales',
                totalExpenses: 'Gastos Totales',
                remainingBudget: 'Presupuesto Restante',
                recentTransactions: 'Transacciones Recientes',
                budgetCategories: 'Categorías de Presupuesto',
                monthlyOverview: 'Resumen Mensual',
                savingsGoal: 'Meta de Ahorro',
                expenseBreakdown: 'Desglose de Gastos',
                noData: 'No hay datos disponibles',
                addFirstExpense: 'Agrega tu primer gasto para comenzar',
              },
              expenses: {
                title: 'Agregar Gastos',
                category: 'Categoría',
                amount: 'Cantidad',
                description: 'Descripción',
                date: 'Fecha',
                frequency: 'Frecuencia',
                addButton: 'Agregar Gasto',
                editButton: 'Editar Gasto',
                deleteButton: 'Eliminar Gasto',
                success: 'Gasto agregado exitosamente',
                error: 'Error al agregar gasto',
                deleteConfirm:
                  '¿Estás seguro de que quieres eliminar este gasto?',
                recurring: 'Gasto Recurrente',
                oneTime: 'Gasto Único',
              },
              paychecks: {
                title: 'Gestión de Nóminas',
                grossPay: 'Salario Bruto',
                netPay: 'Salario Neto',
                payDate: 'Fecha de Pago',
                payFrequency: 'Frecuencia de Pago',
                addPaycheck: 'Agregar Nómina',
                editPaycheck: 'Editar Nómina',
                deductions: 'Deducciones',
                taxes: 'Impuestos',
                benefits: 'Beneficios',
                overtime: 'Horas Extra',
                bonus: 'Bonificación',
              },
              payDetails: {
                title: 'Información de Pago',
                personalInfo: 'Información Personal',
                firstName: 'Nombre',
                lastName: 'Apellido',
                email: 'Correo Electrónico',
                phone: 'Número de Teléfono',
                address: 'Dirección',
                city: 'Ciudad',
                state: 'Estado',
                zipCode: 'Código Postal',
                saveButton: 'Guardar Información',
                updateSuccess: 'Información actualizada exitosamente',
              },
              helpdesk: {
                tickets: {
                  title: 'Mis Tickets de Soporte',
                  ticketId: 'ID del Ticket',
                  subject: 'Asunto',
                  status: 'Estado',
                  priority: 'Prioridad',
                  created: 'Creado',
                  updated: 'Última Actualización',
                  noTickets: 'No se encontraron tickets',
                  viewDetails: 'Ver Detalles',
                  closeTicket: 'Cerrar Ticket',
                },
                createTicket: {
                  title: 'Crear Ticket de Soporte',
                  subject: 'Asunto',
                  description: 'Descripción',
                  priority: 'Prioridad',
                  category: 'Categoría',
                  submitButton: 'Enviar Ticket',
                  success: 'Ticket creado exitosamente',
                  error: 'Error al crear ticket',
                },
              },
              howToBudget: {
                title: 'Cómo Hacer Presupuesto',
                introduction: 'Aprende los conceptos básicos del presupuesto',
                step1: 'Rastrea tus Ingresos',
                step2: 'Lista tus Gastos',
                step3: 'Establece Metas Financieras',
                step4: 'Crea tu Presupuesto',
                step5: 'Monitorea y Ajusta',
                tips: 'Consejos de Presupuesto',
                resources: 'Recursos Adicionales',
              },
              common: {
                save: 'Guardar',
                cancel: 'Cancelar',
                delete: 'Eliminar',
                edit: 'Editar',
                add: 'Agregar',
                update: 'Actualizar',
                create: 'Crear',
                submit: 'Enviar',
                loading: 'Cargando...',
                error: 'Ocurrió un error',
                success: 'Operación completada exitosamente',
                confirm: 'Confirmar',
                yes: 'Sí',
                no: 'No',
                close: 'Cerrar',
                back: 'Atrás',
                next: 'Siguiente',
                previous: 'Anterior',
                search: 'Buscar',
                filter: 'Filtrar',
                clear: 'Limpiar',
                total: 'Total',
                subtotal: 'Subtotal',
                required: 'Este campo es obligatorio',
                invalidEmail: 'Por favor ingrese un email válido',
                passwordMismatch: 'Las contraseñas no coinciden',
                selectLanguage: 'Seleccionar Idioma',
                currentLanguage: 'Idioma Actual',
                availableLanguages: 'Idiomas Disponibles',
              },
              categories: {
                title: 'Categorías',
                housing: 'Vivienda',
                transportation: 'Transporte',
                food: 'Comida y Restaurantes',
                utilities: 'Servicios Públicos',
                healthcare: 'Salud',
                entertainment: 'Entretenimiento',
                shopping: 'Compras',
                education: 'Educación',
                insurance: 'Seguros',
                savings: 'Ahorros',
                debt: 'Pago de Deudas',
                other: 'Otros',
              },
              frequency: {
                weekly: 'Semanal',
                biweekly: 'Quincenal',
                monthly: 'Mensual',
                quarterly: 'Trimestral',
                annually: 'Anual',
                oneTime: 'Una vez',
              },
              status: {
                open: 'Abierto',
                inProgress: 'En Progreso',
                resolved: 'Resuelto',
                closed: 'Cerrado',
                pending: 'Pendiente',
                active: 'Activo',
                inactive: 'Inactivo',
              },
              priority: {
                low: 'Baja',
                medium: 'Media',
                high: 'Alta',
                urgent: 'Urgente',
              },
              months: {
                january: 'Enero',
                february: 'Febrero',
                march: 'Marzo',
                april: 'Abril',
                may: 'Mayo',
                june: 'Junio',
                july: 'Julio',
                august: 'Agosto',
                september: 'Septiembre',
                october: 'Octubre',
                november: 'Noviembre',
                december: 'Diciembre',
              },
              errors: {
                networkError: 'Error de red. Por favor verifica tu conexión.',
                serverError: 'Error del servidor. Por favor intenta más tarde.',
                unauthorizedError:
                  'No estás autorizado para realizar esta acción.',
                validationError:
                  'Por favor verifica tu entrada e intenta de nuevo.',
                notFoundError: 'El recurso solicitado no fue encontrado.',
              },
            },
          },
          fr: {
            translation: {
              auth: {
                login: {
                  title: 'Se Connecter',
                  username: "Nom d'Utilisateur",
                  password: 'Mot de Passe',
                  loginButton: 'Se Connecter',
                  registerLink: "Pas de compte ? S'inscrire",
                  error: "Nom d'utilisateur ou mot de passe invalide",
                  alreadyLoggedIn:
                    'Vous êtes déjà connecté. Cliquez sur le bouton ci-dessous pour aller à votre Tableau de Bord.',
                },
                register: {
                  title: 'Créer un Compte',
                  username: "Nom d'Utilisateur",
                  email: 'Email',
                  password: 'Mot de Passe',
                  confirmPassword: 'Confirmer le Mot de Passe',
                  registerButton: 'Créer un Compte',
                  loginLink: 'Déjà un compte ? Se connecter',
                  success: 'Compte créé avec succès',
                },
              },
              navigation: {
                dashboard: 'Tableau de Bord',
                addExpenses: 'Ajouter Dépenses',
                paychecks: 'Fiches de Paie',
                payInfo: 'Informations de Paie',
                howToBudget: 'Comment Budgéter',
                tickets: 'Mes Tickets',
                createTicket: 'Créer Ticket',
                logout: 'Déconnexion',
                home: 'Accueil',
                profile: 'Profil',
              },
              dashboard: {
                title: 'Tableau de Bord Budget',
                welcome: 'Bienvenue sur votre Tableau de Bord Budget',
                totalIncome: 'Revenus Totaux',
                totalExpenses: 'Dépenses Totales',
                remainingBudget: 'Budget Restant',
                recentTransactions: 'Transactions Récentes',
                budgetCategories: 'Catégories de Budget',
                monthlyOverview: 'Aperçu Mensuel',
                savingsGoal: "Objectif d'Épargne",
                expenseBreakdown: 'Répartition des Dépenses',
                noData: 'Aucune donnée disponible',
                addFirstExpense:
                  'Ajoutez votre première dépense pour commencer',
              },
              expenses: {
                title: 'Ajouter Dépenses',
                category: 'Catégorie',
                amount: 'Montant',
                description: 'Description',
                date: 'Date',
                frequency: 'Fréquence',
                addButton: 'Ajouter Dépense',
                editButton: 'Modifier Dépense',
                deleteButton: 'Supprimer Dépense',
                success: 'Dépense ajoutée avec succès',
                error: "Échec de l'ajout de la dépense",
                deleteConfirm:
                  'Êtes-vous sûr de vouloir supprimer cette dépense?',
                recurring: 'Dépense Récurrente',
                oneTime: 'Dépense Unique',
              },
              paychecks: {
                title: 'Gestion des Fiches de Paie',
                grossPay: 'Salaire Brut',
                netPay: 'Salaire Net',
                payDate: 'Date de Paie',
                payFrequency: 'Fréquence de Paie',
                addPaycheck: 'Ajouter Fiche de Paie',
                editPaycheck: 'Modifier Fiche de Paie',
                deductions: 'Déductions',
                taxes: 'Taxes',
                benefits: 'Avantages',
                overtime: 'Heures Supplémentaires',
                bonus: 'Prime',
              },
              payDetails: {
                title: 'Informations de Paie',
                personalInfo: 'Informations Personnelles',
                firstName: 'Prénom',
                lastName: 'Nom de Famille',
                email: 'Email',
                phone: 'Numéro de Téléphone',
                address: 'Adresse',
                city: 'Ville',
                state: 'État',
                zipCode: 'Code Postal',
                saveButton: 'Sauvegarder Informations',
                updateSuccess: 'Informations mises à jour avec succès',
              },
              helpdesk: {
                tickets: {
                  title: 'Mes Tickets de Support',
                  ticketId: 'ID du Ticket',
                  subject: 'Sujet',
                  status: 'Statut',
                  priority: 'Priorité',
                  created: 'Créé',
                  updated: 'Dernière Mise à Jour',
                  noTickets: 'Aucun ticket trouvé',
                  viewDetails: 'Voir Détails',
                  closeTicket: 'Fermer Ticket',
                },
                createTicket: {
                  title: 'Créer Ticket de Support',
                  subject: 'Sujet',
                  description: 'Description',
                  priority: 'Priorité',
                  category: 'Catégorie',
                  submitButton: 'Soumettre Ticket',
                  success: 'Ticket créé avec succès',
                  error: 'Échec de la création du ticket',
                },
              },
              howToBudget: {
                title: 'Comment Budgéter',
                introduction: 'Apprenez les bases de la budgétisation',
                step1: 'Suivez vos Revenus',
                step2: 'Listez vos Dépenses',
                step3: 'Fixez des Objectifs Financiers',
                step4: 'Créez votre Budget',
                step5: 'Surveillez et Ajustez',
                tips: 'Conseils de Budgétisation',
                resources: 'Ressources Supplémentaires',
              },
              common: {
                save: 'Sauvegarder',
                cancel: 'Annuler',
                delete: 'Supprimer',
                edit: 'Modifier',
                add: 'Ajouter',
                update: 'Mettre à Jour',
                create: 'Créer',
                submit: 'Soumettre',
                loading: 'Chargement...',
                error: "Une erreur s'est produite",
                success: 'Opération terminée avec succès',
                confirm: 'Confirmer',
                yes: 'Oui',
                no: 'Non',
                close: 'Fermer',
                back: 'Retour',
                next: 'Suivant',
                previous: 'Précédent',
                search: 'Rechercher',
                filter: 'Filtrer',
                clear: 'Effacer',
                total: 'Total',
                subtotal: 'Sous-total',
                required: 'Ce champ est obligatoire',
                invalidEmail: 'Veuillez entrer un email valide',
                passwordMismatch: 'Les mots de passe ne correspondent pas',
                selectLanguage: 'Sélectionner la Langue',
                currentLanguage: 'Langue Actuelle',
                availableLanguages: 'Langues Disponibles',
              },
              categories: {
                title: 'Catégories',
                housing: 'Logement',
                transportation: 'Transport',
                food: 'Nourriture et Restaurants',
                utilities: 'Services Publics',
                healthcare: 'Santé',
                entertainment: 'Divertissement',
                shopping: 'Shopping',
                education: 'Éducation',
                insurance: 'Assurance',
                savings: 'Épargne',
                debt: 'Remboursement de Dette',
                other: 'Autres',
              },
              frequency: {
                weekly: 'Hebdomadaire',
                biweekly: 'Bi-hebdomadaire',
                monthly: 'Mensuel',
                quarterly: 'Trimestriel',
                annually: 'Annuel',
                oneTime: 'Une fois',
              },
              status: {
                open: 'Ouvert',
                inProgress: 'En Cours',
                resolved: 'Résolu',
                closed: 'Fermé',
                pending: 'En Attente',
                active: 'Actif',
                inactive: 'Inactif',
              },
              priority: {
                low: 'Faible',
                medium: 'Moyenne',
                high: 'Élevée',
                urgent: 'Urgente',
              },
              months: {
                january: 'Janvier',
                february: 'Février',
                march: 'Mars',
                april: 'Avril',
                may: 'Mai',
                june: 'Juin',
                july: 'Juillet',
                august: 'Août',
                september: 'Septembre',
                october: 'Octobre',
                november: 'Novembre',
                december: 'Décembre',
              },
              errors: {
                networkError:
                  'Erreur réseau. Veuillez vérifier votre connexion.',
                serverError: 'Erreur serveur. Veuillez réessayer plus tard.',
                unauthorizedError:
                  "Vous n'êtes pas autorisé à effectuer cette action.",
                validationError: 'Veuillez vérifier votre saisie et réessayer.',
                notFoundError: "La ressource demandée n'a pas été trouvée.",
              },
            },
          },
        },
      });

      this.isInitialized = true;
      console.log('i18n initialized successfully');
      console.log('Current language:', i18next.language);
    } catch (error) {
      console.error('Failed to initialize i18n:', error);
    }
  }

  translate(key: string, options?: any): string {
    if (!this.isInitialized) {
      console.warn('i18n not initialized yet');
      return key;
    }
    const result = i18next.t(key, options) as string;
    if (result === key) {
      console.warn(`Translation missing for key: ${key}`);
    }
    return result;
  }

  getCurrentLanguage(): string {
    return i18next.language || 'en';
  }

  isReady(): boolean {
    return this.isInitialized && i18next.isInitialized;
  }

  changeLanguage(lng: string): Promise<any> {
    return i18next.changeLanguage(lng);
  }

  getAvailableLanguages(): string[] {
    return ['en', 'es', 'fr'];
  }

  getLanguageDisplayName(lng: string): string {
    const displayNames: { [key: string]: string } = {
      en: 'English',
      es: 'Español',
      fr: 'Français',
    };
    return displayNames[lng] || lng;
  }
}
