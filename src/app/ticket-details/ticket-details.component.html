<div class="d-flex justify-content-center mt-4">
  <div class="card shadow w-75 p-5">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <div>
          <p class="fw-bold">Ticket ID</p>
          <p>{{ ticketDetails.value()?.id ?? "Not set" }}</p>
        </div>
        <div>
          <p class="fw-bold">Client Name</p>
          <p>{{ ticketDetails.value()?.name ?? "Not set" }}</p>
        </div>
        <div>
          <p class="fw-bold">Client Email</p>
          <p>{{ ticketDetails.value()?.email ?? "Not set" }}</p>
        </div>

        <div>
          <p class="fw-bold">Ticket Severity</p>
          <div class="d-flex justify-content-center align-items-center gap-2">
            @if(ticketDetails.value()?.ticketSeverityId === 4) {
            <i
              [ngClass]="getTicketSeverityColorClasses()"
              class="fas fa-circle-exclamation"
            ></i>
            }
            <p class="fw-bold mb-0" [ngClass]="getTicketSeverityColorClasses()">
              {{ ticketDetails.value()?.ticketSeverityName ?? "Not set" }}
            </p>
          </div>
        </div>
      </div>
      <div class="border-top border-5 my-5">
        <p class="mt-2 fw-bold">Subject</p>
        <p>{{ filteredSubject() }}</p>
      </div>
      <div class="border-top border-5 my-5">
        <p class="mt-2 fw-bold">Message from Client</p>
        <p class="border border-3 p-2">
          {{ filteredMessage() }}
        </p>
      </div>

      <!-- Improved Reply Section -->
      <div class="border-top border-2 pt-4 mt-4">
        <h6 class="fw-bold mb-3">Reply to Customer</h6>
        <form [formGroup]="formGroup">
          <div class="mb-3">
            <textarea
              formControlName="message"
              class="form-control"
              placeholder="Type your reply here..."
              rows="3"
              style="resize: vertical"
            ></textarea>

            <!-- Profanity Filter Preview -->
            @if (formGroup.controls.message.value?.trim()) {
            <div class="mt-2">
              @if (hasProfanity()) {
              <div class="alert alert-warning py-2 px-3 mb-2">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <small>
                  <strong>Filtered Preview:</strong> Inappropriate language will
                  be automatically filtered.
                </small>
              </div>
              <div class="card bg-light">
                <div class="card-body py-2 px-3">
                  <small class="text-muted">Your message will appear as:</small>
                  <div class="mt-1">
                    <small>"{{ messagePreview() }}"</small>
                  </div>
                </div>
              </div>
              } @else {
              <div class="alert alert-success py-2 px-3 mb-0">
                <i class="fas fa-check-circle me-2"></i>
                <small
                  >Message looks good! No inappropriate language
                  detected.</small
                >
              </div>
              }
            </div>
            }

            <div class="d-flex justify-content-between align-items-center mt-2">
              <small class="text-muted">
                <i class="fas fa-shield-alt me-1"></i>
                Messages are automatically filtered for inappropriate content
              </small>
              <button
                (click)="sendReply()"
                class="btn btn-success"
                type="button"
                [disabled]="!formGroup.controls.message.value?.trim()"
              >
                <i class="fas fa-paper-plane me-1"></i>
                Send Reply
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex gap-2 mt-4 pt-3 border-top">
        <button
          [disabled]="this.ticketDetails.value()?.isResolved"
          (click)="resolveTicket()"
          class="btn btn-primary"
        >
          <i class="fas fa-check-circle me-1"></i>
          {{
            this.ticketDetails.value()?.isResolved
              ? "Resolved"
              : "Resolve Ticket"
          }}
        </button>
        @if(this.ticketDetails.value()?.isResolved){

        <button
          (click)="unresolveTicket()"
          [disabled]="!this.ticketDetails.value()?.isResolved"
          class="btn btn-outline-success"
        >
          <i class="fas fa-check-circle me-1"></i>
          Re-open Ticket
        </button>
        }
      </div>
    </div>
  </div>
</div>
